# Shellcodes

## Compliance 
The shellcode must fill the following requirements:
- Does not contain variables
  - The entire shellcode must be under the `.text` section. 
  - Move strings to the stack, max size per "push" is 8 bytes, in reverse order.
```asm
mov rbx, 'hi'
push rbx
mov rbx, 'bonjour '
push rbx
mov rsi, rsp
```
- Does not refer to direct memory addresses
  - Replace with calls to labels or rip-relative addresses (for calls and loops)
  - Push to the Stack and use rsp as the address (for mov and other assembly instructions)
- Does not contain any null bytes (00)
  - Use registers that match the data size (like `mov al, 1` instead of `mov rax, 1`)
```asm
    mov bx, 'hi'
    push bx
    mov rbx, 'bonjour '
    push rbx
    mov rsi, rsp
    mov al, 1
    mov dil, 1
    mov dl, 10
    syscall
```

## With pwntools
- [pwntools asm docs](https://docs.pwntools.com/en/stable/asm.html)
- [pwntools cli docs](https://docs.pwntools.com/en/stable/commandline.html)

```bash
pwn asm 'pop rax; push rax;' -c 'amd64'
#
# 5850
#

pwn disasm '5850' -c 'amd64'
#
#   0:    58                       pop    rax
#   1:    50                       push   rax
#
```

```python
python
>>> from pwn import *
>>> context.update(arch='amd64', os='linux')
>>> asm('mov rax,1')
>>> asm('mov rax,1').hex()
>>> printb = lambda x: print(' '.join(f'{byte:02x}' for byte in x))
>>> lprintb = lambda filename: print(' '.join(f'{byte:02x}' for byte in ELF(filename).section('.text')))
>>> printb(ELF('someExe').section('.text'))

>>> run_shellcode(unhex('4831db66bb7921...')).interactive()
```
